
DECLARE @MONTH INT = 5;  -- THÁNG (VÍ DỤ: THÁNG 11)
DECLARE @YEAR INT = 2025; -- NĂM (VÍ DỤ: NĂM 2025)

-- NGÀY ĐẦU THÁNG
DECLARE @FIRST_DAY_OF_MONTH DATE;

-- NGÀY CUỐI THÁNG
DECLARE @LAST_DAY_OF_MONTH DATE;

SELECT 
	@FIRST_DAY_OF_MONTH = CONVERT(DATE, DATEADD(MONTH, @MONTH - 1, DATEADD(YEAR, @YEAR - 1900, 0))),
	@LAST_DAY_OF_MONTH = EOMONTH(DATEADD(MONTH, @MONTH - 1, DATEADD(YEAR, @YEAR - 1900, 0)));

SELECT *
FROM (
	SELECT
		FORMAT(EFFECT_DATE, 'dd/MM/yyyy') EFFECT_DATE,
		ROW_NUMBER() OVER(
			PARTITION BY EMPLOYEE_ID -- PHÂN LOẠI THEO CỘT NÀO
			ORDER BY EFFECT_DATE DESC -- SẮP XẾP THEO CỘT NÀO
		) AS [RANK_NUMBER]
	FROM HU_WORKING
	WHERE
		EMPLOYEE_ID = 611
		AND YEAR(EFFECT_DATE) = 2025
		AND ID IN (
			SELECT WORKING_ID
			FROM HU_CONTRACT
		)
		AND CONVERT(DATE, EFFECT_DATE) <= @FIRST_DAY_OF_MONTH
) AS HW_TEST
WHERE
	[RANK_NUMBER] = 1

UNION ALL

SELECT *
FROM (
	SELECT
		FORMAT(EFFECT_DATE, 'dd/MM/yyyy') EFFECT_DATE,
		ROW_NUMBER() OVER(
			PARTITION BY EMPLOYEE_ID -- PHÂN LOẠI THEO CỘT NÀO
			ORDER BY EFFECT_DATE DESC -- SẮP XẾP THEO CỘT NÀO
		) AS [RANK_NUMBER]
	FROM HU_WORKING
	WHERE
		EMPLOYEE_ID = 611
		AND YEAR(EFFECT_DATE) = 2025
		AND ID IN (
			SELECT WORKING_ID
			FROM HU_CONTRACT
		)
		AND CONVERT(DATE, EFFECT_DATE) <= @LAST_DAY_OF_MONTH
		AND CONVERT(DATE, EFFECT_DATE) > @FIRST_DAY_OF_MONTH 
) AS HW_TEST
WHERE
	[RANK_NUMBER] = 1
